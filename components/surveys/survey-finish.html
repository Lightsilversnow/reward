<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Reward system</title>
    <link rel="stylesheet" href="/css/style.css" type="text/css" />
    <link rel="manifest" href="manifest.json" />
    <link rel="" href="/js/bottom-menu.js" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script src="js/scripts.js" type="text/javascript"></script>

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
  </head>
  <body>
    <!-- Include the mobile menu -->
    <div id="mobileMenuContainer"></div>

    <div class="bg">
      <div class="container text-center">
        <img
          class="img-fluid img-resize"
          src="/images/status/party.png"
          alt="..."
        />
        <div class="text">
          <p>Je hebt de vragenlijst voltooid. Wat wil je nu doen?</p>
        </div>
        <a href="/components/reward/reward-add-sunflower.html"
          ><button
            type="button"
            class="btn btn-primary"
            data-mdb-ripple-init
            style="width: 255px; height: 60px; background-color: #9a9aff"
          >
            Ontgrendel plant
          </button></a
        >
        <a href="/components/home/home.html"
          ><button
            type="button"
            class="btn btn-primary"
            data-mdb-ripple-init
            style="width: 255px; height: 60px; background-color: #9a9aff"
          >
            Naar het hoofdmenu
          </button></a
        >
      </div>
    </div>
    <!-- Include the mobile top menu -->
    <div id="dropdownOverlay">
      <button class="profile-button">
        <span class="navbar-icon"><i class="fa-solid fa-user"></i></span>
      </button>
      <div class="dropdown-content">
        <button class="close-button" onclick="closeDropdown()">&#10006;</button>
        <a href="#">Profile</a>
        <a href="#">Support</a>
        <a href="#">Settings</a>
        <a href="#">Logout</a>
      </div>
    </div>

    <script>
      document.getElementById("mobileMenuContainer").innerHTML = `
        <iframe id="topNavbarFrame" src="/components/top-navbar/top-navbar.html" frameborder="0" width="100%" height="70" position="absolute"></iframe>
      `;

      // Function to update the top navbar title
      function updateTopNavbarTitle(title) {
        const topNavbarFrame = document.getElementById("topNavbarFrame");
        if (topNavbarFrame && topNavbarFrame.contentWindow) {
          topNavbarFrame.contentWindow.postMessage(
            { type: "updateTitle", title },
            "*"
          );
        }
      }

      // Function to close the dropdown
      function closeDropdown() {
        const dropdownOverlay = document.getElementById("dropdownOverlay");
        if (dropdownOverlay) {
          dropdownOverlay.classList.remove("show");
          dropdownOverlay.classList.add("hide");
        }
      }

      // Example: Update the top navbar title when a page is loaded
      window.addEventListener("load", function () {
        const pageTitle = document.title;
        updateTopNavbarTitle(pageTitle);
      });

      // Handle dropdown logic in the parent document
      window.addEventListener("message", function (event) {
        if (event.data && event.data.type === "toggleDropdown") {
          const dropdownOverlay = document.getElementById("dropdownOverlay");
          if (dropdownOverlay) {
            dropdownOverlay.classList.toggle("show");
            // Add class for smooth sliding when closing
            if (!dropdownOverlay.classList.contains("show")) {
              dropdownOverlay.classList.add("hide");
            } else {
              dropdownOverlay.classList.remove("hide");
            }
          }
        }
      });

      // Fetch the rewardUnlocked value
      // This code fetches the rewardUnlocked value to verify the amount of surveys that have been filled in by the user.
      let currentCount = parseInt(localStorage.getItem("rewardUnlocked"), 10);
      // Fix for the NaN result bug
      currentCount = isNaN(parseInt(currentCount, 10))
        ? 0
        : parseInt(currentCount, 10);
      localStorage.setItem("rewardUnlocked", currentCount);
      // This makes the amount into a text format so that I can add it to the page
      document.getElementById("rewardUnlocked").textContent = currentCount;
      console.log(currentCount);
    </script>

    <!-- Include the mobile bottom menu -->
    <div id="mobileBottomMenuContainer"></div>
    <script>
      document.getElementById("mobileBottomMenuContainer").innerHTML = `
    <iframe src="/components/bottom-menu/bottom-menu.html" frameborder="0" width="100%" height="70" position="fixed" bottom="0"></iframe>
  `;
    </script>
  </body>
</html>
